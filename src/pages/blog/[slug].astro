---
import Base from "../../layouts/Base.astro";
import { blogPosts } from "../../data/blogData.js";
import Breadcrumbs from "../../components/blog/Breadcrumbs.astro";

export async function getStaticPaths() {
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// Filtrar artículos relacionados
const relatedPosts = blogPosts.filter((p) => p.slug !== post.slug).slice(0, 2);
---

<Base title={post.title}>
  <article class="max-w-4xl mx-auto px-6 py-20">
    <Breadcrumbs
      items={[
        { label: "首页", href: "/" },
        { label: "博客", href: "/blog" },
        { label: post.title },
      ]}
    />

    <img
      src={post.image}
      alt={post.title}
      class="w-full h-96 object-cover rounded-2xl shadow mb-8"
    />

    <h1 class="text-3xl md:text-4xl font-bold text-[#2F855A] mb-4">
      {post.title}
    </h1>

    <p class="text-gray-500 text-sm mb-8">
      {post.date} • {post.author}
    </p>

    <div
      class="prose prose-lg max-w-none text-gray-800"
      set:html={post.content}
    />

    <a
      href="/blog"
      class="inline-block my-6 px-6 py-2 bg-[#2F855A] text-white rounded-full hover:bg-[#096939] transition"
    >
      返回博客
    </a>

    <!-- Artículos relacionados -->
    {
      relatedPosts.length > 0 && (
        <section class="mt-2">
          <h2 class="text-2xl md:text-3xl font-bold text-[#2F855A] mb-6">
            相关文章
          </h2>

          <div class="grid gap-6 md:grid-cols-2">
            {relatedPosts.map((p) => (
              <article class="bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-lg transition">
                <a href={`/blog/${p.slug}`} class="block">
                  <img
                    src={p.image}
                    alt={p.title}
                    class="w-full h-48 object-cover"
                  />
                </a>
                <div class="p-4 flex flex-col justify-between h-full">
                  <h3 class="text-lg font-bold text-[#2F855A] mb-2">
                    <a href={`/blog/${p.slug}`} class="hover:underline">
                      {p.title}
                    </a>
                  </h3>
                  <p class="text-gray-600 text-sm">{p.description}</p>
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }
  </article>
</Base>